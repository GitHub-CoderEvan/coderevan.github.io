<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Evan Deng"><meta name="keywords" content=""><meta name="description" content="12.viper配置管理01.viper介绍 参考博客(opens new window)  1.1 viper是什么？ Viper (opens new window)是适用于Go应用程序的完整配置解决方案。 它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式 viper功能 设置默认值 从JSON、TOML、YAML、HCL、envfile和Java properties格式的"><meta property="og:type" content="article"><meta property="og:title" content="viper配置管理"><meta property="og:url" content="http://example.com/2022/06/09/Go%E5%B8%B8%E7%94%A8%E5%BA%93%E4%BB%8B%E7%BB%8D%20-%20viper/index.html"><meta property="og:site_name" content="Evan的博客"><meta property="og:description" content="12.viper配置管理01.viper介绍 参考博客(opens new window)  1.1 viper是什么？ Viper (opens new window)是适用于Go应用程序的完整配置解决方案。 它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式 viper功能 设置默认值 从JSON、TOML、YAML、HCL、envfile和Java properties格式的"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/cover2-12.png"><meta property="article:published_time" content="2022-06-09T13:24:37.000Z"><meta property="article:modified_time" content="2024-01-22T12:58:59.000Z"><meta property="article:author" content="Evan Deng"><meta property="article:tag" content="Go常用库"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://example.com/img/cover2-12.png"><title>viper配置管理 - Evan的博客</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"example.com",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Evan的博客" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>evan&#39;s blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>大佬博客</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="viper配置管理"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-06-09 21:24" pubdate>2022年6月9日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 5.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 49 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">viper配置管理</h1><div class="markdown-body"><h1 id="12-viper配置管理"><a href="#12-viper配置管理" class="headerlink" title="12.viper配置管理"></a>12.viper配置管理</h1><h2 id="01-viper介绍"><a href="#01-viper介绍" class="headerlink" title="01.viper介绍"></a>01.viper介绍</h2><ul><li><a target="_blank" rel="noopener" href="https://www.liwenzhou.com/posts/Go/viper_tutorial/">参考博客(opens new window)</a></li></ul><h3 id="1-1-viper是什么？"><a href="#1-1-viper是什么？" class="headerlink" title="1.1 viper是什么？"></a>1.1 viper是什么？</h3><ul><li><a target="_blank" rel="noopener" href="https://github.com/spf13/viper">Viper (opens new window)</a>是适用于Go应用程序的完整配置解决方案。</li><li>它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式</li><li>viper功能<ul><li>设置默认值</li><li>从<code>JSON</code>、<code>TOML</code>、<code>YAML</code>、<code>HCL</code>、<code>envfile</code>和<code>Java properties</code>格式的配置文件读取配置信息</li><li>实时监控和重新读取配置文件（可选）</li><li>从环境变量中读取</li><li>从远程配置系统（etcd或Consul）读取并监控配置变化</li><li>从命令行参数读取配置</li><li>从buffer读取配置</li><li>显式配置值</li></ul></li></ul><h3 id="1-2-为什么选择Viper"><a href="#1-2-为什么选择Viper" class="headerlink" title="1.2 为什么选择Viper?"></a>1.2 为什么选择Viper?</h3><ul><li>在构建现代应用程序时，你无需担心配置文件格式；</li><li>Viper能够为你执行下列操作：<ul><li>查找、加载和反序列化JSON、TOML、YAML、HCL、INI、envfile和Java properties格式的配置文件。</li><li>提供一种机制为你的不同配置选项设置默认值。</li><li>提供一种机制来通过命令行参数覆盖指定选项的值。</li><li>提供别名系统，以便在不破坏现有代码的情况下轻松重命名参数。</li><li>当用户提供了与默认值相同的命令行或配置文件时，可以很容易地分辨出它们之间的区别。</li></ul></li><li><code>Viper会按照下面的优先，每个项目的优先级都高于它下面的项目</code><ul><li>显示调用<code>Set</code>设置值</li><li>命令行参数（flag）</li><li>环境变量</li><li>配置文件</li><li>key&#x2F;value存储</li><li>默认值</li></ul></li><li><strong>重要：</strong> 目前Viper配置的键（Key）是<code>大小写不敏感的</code></li></ul><h3 id="1-3-viper安装"><a href="#1-3-viper安装" class="headerlink" title="1.3 viper安装"></a>1.3 viper安装</h3><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">go</span> get github<span class="token punctuation">.</span>com<span class="token operator">/</span>spf13<span class="token operator">/</span>viper<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h2 id="02-viper设置配置"><a href="#02-viper设置配置" class="headerlink" title="02.viper设置配置"></a>02.viper设置配置</h2><h3 id="2-1-建立默认值"><a href="#2-1-建立默认值" class="headerlink" title="2.1 建立默认值"></a>2.1 建立默认值</h3><ul><li>一个好的配置系统应该支持默认值。</li><li>键不需要默认值，但如果没有通过配置文件、环境变量、远程配置或命令行标志（flag）设置键，则默认值非常有用。</li><li>例如：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"ContentDir"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"LayoutDir"</span><span class="token punctuation">,</span> <span class="token string">"layouts"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">"Taxonomies"</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"tag"</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token punctuation">,</span> <span class="token string">"category"</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="2-2-读取配置文件"><a href="#2-2-读取配置文件" class="headerlink" title="2.2 读取配置文件"></a>2.2 读取配置文件</h3><ul><li>Viper需要最少知道在哪里查找配置文件的配置。</li><li>Viper支持<code>JSON</code>、<code>TOML</code>、<code>YAML</code>、<code>HCL</code>、<code>envfile</code>和<code>Java properties</code>格式的配置文件。</li><li>Viper可以搜索多个路径，但目前单个Viper实例只支持单个配置文件。</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span><span class="token string">"./config.yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 指定配置文件路径</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigName</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span> <span class="token comment">// 配置文件名称(无扩展名)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 如果配置文件的名称中没有扩展名，则需要配置此项</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"/etc/appname/"</span><span class="token punctuation">)</span>   <span class="token comment">// 查找配置文件所在的路径</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"$HOME/.appname"</span><span class="token punctuation">)</span>  <span class="token comment">// 多次调用以添加多个搜索路径</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>               <span class="token comment">// 还可以在工作目录中查找配置</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 查找并读取配置文件</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 处理读取配置文件的错误</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="2-3-写入配置文件"><a href="#2-3-写入配置文件" class="headerlink" title="2.3 写入配置文件"></a>2.3 写入配置文件</h3><ul><li>从配置文件中读取配置文件是有用的，但是有时你想要存储在运行时所做的所有修改。</li><li>为此，可以使用下面一组命令，每个命令都有自己的用途</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">viper<span class="token punctuation">.</span><span class="token function">WriteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 将当前配置写入“viper.AddConfigPath()”和“viper.SetConfigName”设置的预定义路径</span>
viper<span class="token punctuation">.</span><span class="token function">SafeWriteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">WriteConfigAs</span><span class="token punctuation">(</span><span class="token string">"/path/to/my/.config"</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SafeWriteConfigAs</span><span class="token punctuation">(</span><span class="token string">"/path/to/my/.config"</span><span class="token punctuation">)</span> <span class="token comment">// 因为该配置文件写入过，所以会报错</span>
viper<span class="token punctuation">.</span><span class="token function">SafeWriteConfigAs</span><span class="token punctuation">(</span><span class="token string">"/path/to/my/.other_config"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="2-4-监控并重新读取配置文件"><a href="#2-4-监控并重新读取配置文件" class="headerlink" title="2.4 监控并重新读取配置文件"></a>2.4 监控并重新读取配置文件</h3><ul><li>确保在调用<code>WatchConfig()</code>之前添加了所有的配置路径。</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">OnConfigChange</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>e fsnotify<span class="token punctuation">.</span>Event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 配置文件发生变更之后会调用的回调函数</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Config file changed:"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="2-4-覆盖设置"><a href="#2-4-覆盖设置" class="headerlink" title="2.4 覆盖设置"></a>2.4 覆盖设置</h3><ul><li>这些可能来自命令行标志，也可能来自你自己的应用程序逻辑。</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Verbose"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"LogFile"</span><span class="token punctuation">,</span> LogFile<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><h2 id="03-viper读取配置"><a href="#03-viper读取配置" class="headerlink" title="03.viper读取配置"></a>03.viper读取配置</h2><h3 id="3-1-几种访问值的方法"><a href="#3-1-几种访问值的方法" class="headerlink" title="3.1 几种访问值的方法"></a>3.1 几种访问值的方法</h3><ul><li>在Viper中，有几种方法可以根据值的类型获取值</li><li><code>Get(key string) : interface&#123;&#125;</code></li><li><code>GetBool(key string) : bool</code></li><li><code>GetFloat64(key string) : float64</code></li><li><code>GetInt(key string) : int</code></li><li><code>GetIntSlice(key string) : []int</code></li><li><code>GetString(key string) : string</code></li><li><code>GetStringMap(key string) : map[string]interface&#123;&#125;</code></li><li><code>GetStringMapString(key string) : map[string]string</code></li><li><code>GetStringSlice(key string) : []string</code></li><li><code>GetTime(key string) : time.Time</code></li><li><code>GetDuration(key string) : time.Duration</code></li><li><code>IsSet(key string) : bool</code></li><li><code>AllSettings() : map[string]interface&#123;&#125;</code></li></ul><p>例如：</p><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"logfile"</span><span class="token punctuation">)</span> <span class="token comment">// 不区分大小写的设置和获取</span>
<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">"verbose"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"verbose enabled"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="3-2-访问嵌套的键"><a href="#3-2-访问嵌套的键" class="headerlink" title="3.2 访问嵌套的键"></a>3.2 访问嵌套的键</h3><ul><li>问器方法也接受深度嵌套键的格式化路径</li><li>例如，如果加载下面的JSON文件</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"host"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"address"</span><span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>
        <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">5799</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"datastore"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"metric"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
            <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">3099</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token property">"warehouse"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"198.0.0.1"</span><span class="token punctuation">,</span>
            <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">2112</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><ul><li>Viper可以通过传入<code>.</code>分隔的路径来访问嵌套字段：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"datastore.metric.host"</span><span class="token punctuation">)</span> <span class="token comment">// (返回 "127.0.0.1")</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><h3 id="3-3-提取子树"><a href="#3-3-提取子树" class="headerlink" title="3.3 提取子树"></a>3.3 提取子树</h3><ul><li>例如，<code>viper</code>实例现在代表了以下配置：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">app</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache1</span><span class="token punctuation">:</span>
    <span class="token key atrule">max-items</span><span class="token punctuation">:</span> <span class="token number">100</span>
    <span class="token key atrule">item-size</span><span class="token punctuation">:</span> <span class="token number">64</span>
  <span class="token key atrule">cache2</span><span class="token punctuation">:</span>
    <span class="token key atrule">max-items</span><span class="token punctuation">:</span> <span class="token number">200</span>
    <span class="token key atrule">item-size</span><span class="token punctuation">:</span> <span class="token number">80</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><ul><li>执行后：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">subv <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">"app.cache1"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><ul><li><code>subv</code>现在就代表：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">max-items</span><span class="token punctuation">:</span> <span class="token number">100</span>
<span class="token key atrule">item-size</span><span class="token punctuation">:</span> <span class="token number">64</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><ul><li>假设我们现在有这么一个函数：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">NewCache</span><span class="token punctuation">(</span>cfg <span class="token operator">*</span>Viper<span class="token punctuation">)</span> <span class="token operator">*</span>Cache <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure><ul><li>它基于<code>subv</code>格式的配置信息创建缓存。现在，可以轻松地分别创建这两个缓存，如下所示：</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go">cfg1 <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">"app.cache1"</span><span class="token punctuation">)</span>
cache1 <span class="token operator">:=</span> <span class="token function">NewCache</span><span class="token punctuation">(</span>cfg1<span class="token punctuation">)</span>

cfg2 <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">"app.cache2"</span><span class="token punctuation">)</span>
cache2 <span class="token operator">:=</span> <span class="token function">NewCache</span><span class="token punctuation">(</span>cfg2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="3-4-反序列化"><a href="#3-4-反序列化" class="headerlink" title="3.4 反序列化"></a>3.4 反序列化</h3><p>你还可以选择将所有或特定的值解析到结构体、map等。</p><p>有两种方法可以做到这一点：</p><ul><li><code>Unmarshal(rawVal interface&#123;&#125;) : error</code></li><li><code>UnmarshalKey(key string, rawVal interface&#123;&#125;) : error</code></li></ul><p><img src="/img/image-20210609094655146.46d6e697.png" srcset="/img/loading.gif" lazyload></p><ul><li><code>main.go</code></li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/spf13/viper"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Port        <span class="token builtin">int</span>    <span class="token string">`mapstructure:"port"`</span>
	Version     <span class="token builtin">string</span> <span class="token string">`mapstructure:"version"`</span>
	MySQLConfig <span class="token string">`mapstructure:"mysql"`</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> MySQLConfig <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Host   <span class="token builtin">string</span> <span class="token string">`mapstructure:"host"`</span>
	DbName <span class="token builtin">string</span> <span class="token string">`mapstructure:"dbname"`</span>
	Port   <span class="token builtin">int</span>    <span class="token string">`mapstructure:"port"`</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 读取配置文件</span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span><span class="token string">"./config.yaml"</span><span class="token punctuation">)</span> <span class="token comment">// 指定配置文件路径</span>

	err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 查找并读取配置文件</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>             <span class="token comment">// 处理读取配置文件的错误</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">var</span> c Config

	<span class="token keyword">if</span> err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"viper.Unmarshal failed, err:%v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"c:%#v\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><ul><li>config.yaml</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"v0.0.2"</span>

<span class="token key atrule">mysql</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">13306</span>
  <span class="token key atrule">dbname</span><span class="token punctuation">:</span> <span class="token string">"sql_demo"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h2 id="04-使用Viper示例"><a href="#04-使用Viper示例" class="headerlink" title="04.使用Viper示例"></a>04.使用Viper示例</h2><ul><li>目录结构</li></ul><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATIAAAClCAYAAADf0nGKAAAgAElEQVR4nO2de1Bc95XnP7cRCMSzuyX0tCMQMIptybIaeQxrxxkTawxRElkR+JHE8sxmmsxW7dbCOrVTW1bKFWd3djYOpGpSKdMzdqzYlcSgTOREBgcFPyJHnVhCfuDEuBtoWbb14v0SCETf/aMf3G4aaOhuuhvOp6qr4N7f4/SF/vY55/e79ygtLS2qTqcjOTmZm2++mYGRCQRBEGKd/u5PAZicnEQXZVsEQRBCRoRMEIS4R4RMEIS4R4RMEIS4R4RMEOIAT2JbCIwImSAIcY8ImSAIcc+qaBsgxD9Op5PRkSGujg4zNXUdgISEVaxJTSc1LQOdLrzfl39ue5f3295ZVN9bduzi5h23htWeeGRs7CoAKSlromxJeAhJyLp7+xmfuBaSAclJq1ln1Ic0hhAdVFVloK+bvp4rOJ1TM84PDfSh0yVgWJtNlmEdiqKEZd7BwQE+Pv/RovrecOPWsNigZXx8jLdbT6OqasDziqJwm2kPyckpYZ97MdT/4nnOn3MAcOPWHCoe/EaULQqdkITscm8vQyMjIRmQkZYmQhaHOJ1TXPj4HGNXR1AUHRlZBhITk+jtvgSAcd0GJicnGB4coOfKRUZHhtl0w1Z0uoSQ587MzOKGGz+z6L7hJjk5hfSMDH7b+JsZYqYoCn9b9qWYETGAkeHhgD/HMys+tFTVLp75yu18l+/xxkuV5ITJa1jOqKrqFbGk1cls2pJDYlISV0env9SSU1IxrF2PwbieC584GLs6woWPz7H5xtyQPbObd9wac+HhLTt2AfiImUfEPOeiwdWrVxkZHiJ7/QaczinefecsQ4MD3vNDgwO8ffY0t+7ajU6XwJXLl0hLz2DNmvgKOWNeyByWUu5+4rTvwUIRnWgy0NftFbEbtubPmQNLTErihq35fHzOztjVEQb6utEbsyNil9Pp5PWWZgA+X7I37Lm5+dCKGRB1EVNVlVdefomuTjs3bs1h/OpVrly57NPm+vXrtDQ30fbOWZLXrOH8OQe52/K5/+CDYUsFLAUhC1m20UC20bCovld6+xi/FsRN6hrh8nhQd3+FsIiZouTyzV/38M2QRpmJqrbwT5sfgBe6+Zd74ucfYj6cU1P09VxBUXRs2pITlFjodK62H3V9SF/PFTKzjOgSQg8xtUxMTHD817+kq8MOwMBgP/u+/FWSkpLCOs98aIUrmiIG4OjqoKvTdT08ObHZ0ApcV6cdR1cHudvyI2pfOAlZyFYnJaFLXkPHaOBE52zkpSqsThoJTsg0KEou//mH3+PlOx/n6dcq+Zd7FtRdCJHR0SGczikyMg0k+olEUlIShrXrvT9rSUxKIj0ji6HBPkZHh0jPCF9edGRkmP+o/5nvh7HDzi9e+AkHKh4mLS09bHMFQ7QFzMOlixcCHt+x8zZ23HobAG3vvk3be28H7LuihAxgeArODk0uqM/65BC+KXPyKdD8+vq31/LIh9/jp/te4pEnTvt6cF1Pc+DOx2nVtH/Iz0vy9Nd6eDP6BQhnPV7Xz/3a8G9l0+Hw19fxc8D0xFv8ypwb1Nu7fOkinR22oNpuyytg/YaNQbUNB2NXRwFm5MSSkpJYlZiEcd0G77HrkxNMTEx/UXmEb+zqaNiE7Nr4OL9/7XesTk4OuADw+9d+R8m9paxOTg7LfB6GBgcYHBxcVN/MzEwyIrDo4E/xnXeTkZnJiVdeZmrKtaq8Y+dt/G3Zl7xtNm3eAuAVs4SEBO6974thEeOlvEYxnyMLiMOOjT18UbuSfuZxHvmrFzl/ocR7SH21ms98/ac89EI3v7pHK1DruH8OYXH1+4DvvNnNr3IDh7OesU1PvMV59zhq19M88xp809zER/+w+NByXfZ6/nDyNbo6O+Zsl7stjzuK71rQ2KFyfdL1heVZnfRgWLveR8QABgf66OvxzcloxwgHq5OTKfvS/WEbL1jeb3uXU2++sai+xXfeTfGdd4fZosDcsmMXr554ZVrIdt02o82OXbf5CFm4PMqlvEZxt7NfVVv4pzsfp/Vrj/HNXK1APMJP/989vu3cQqMVEiX3W9Q8sYfWJ37E6wH2/ahqF8/88Kc89EKjd3xPOGs68xItjuk2fO1FHzFUcr/FN8OQD9PpdHxpfzkbN22etc3GTZv50v7yJU9oC0IsEh8e2ZnHuXvz495ftV6Ql8ICfAILhx0bUJCXM2O4rXmfBT6gwwGf93fKHM28fAZa3SGhPwXnAFxtHvrvkUvQJSYmcqD8IX7+/E/o6+v1OWcwGDlQ/hCJiYkRm382VrnnNK7bQHJKqvd4oKR6ZpaBlDVp3t/Hx0bp7b7kHSMcXBsfp+VEE8PDQwHPp6dnRCS0vGXHrYveXJuZmRlWW+bi/bZ3vN4YQNs7b7Np0xafNm3vTOfIpqameL/tnbB4ZUt5jeJDyKKw3cI/j6ZF7VoaG1JS1nDwga/xs+d/wsiIa+NiWlo6Bx/4WtRuLUlZk8pgfy+TExPexL6H65MTDA70AS4RW5Xoypt5GB7s944RLlYnJ/O5v/nCjGQ/QHb2er745QNhFzGAjMysJclzhcKpN9+YEdp5QsjZkv1TU1O88vKvGRocDDn8XcprtHzjEveCgK1j5rLzuY4PgM8SwFmbs9+C2oSJjMwsDlQ8zOrkZFYnJ3Og4uGofoBSUzPQ6RIYHhpgcsJ3xXliYoK+nsv09Vz2SfIDTE5MMDw0gE6XQGpqRlhtSktL58Gv/x25edOrbLl5+Tz49b9b8hVLcHlBi70XNJxs2Lgp4PG2997mZ88/y8+efzbgiuVcfWOVZStkilLCt57YQ+sTt/M/X53OhamvVnP3E6d56IUf8PkAHt6s/bqe5v5vt8w7tvZ3CI/YZWevZ/+BB9h/4AGys9fP3yGC6BJc906qqpMLnzhwOp3z9nE6XW1V1YlhbXbY95CBK7Tdf+ABdptuZ7fpdvYfeGDJ95CBS8R+2/gbftv4m6iLWU5unncLxY1bc+b838nOXs+NW13f7Lnb8snJzVsSG8NFfISWiyTH3MRHedV8xifftYfvvNntt1Aws98blHK3tl/h93jjpXt82swY+2svcv77ngWCEv7vC4/wma/fzo1PLGz7RSAWe29hJMgyrGN0ZJixqyN8fM7uvUUpEJMTE1z4xMHEtXFS1qSRZVgXMbt0Oh333HtfxMafD4+IeW5R8uzwj9a+MkVRuO+LX5lxi9Ibr57g+nXXU0pWrVrF3ffcO+MWpXja1Q+ghFIO7n1bB5npaaxfv4Heyfm/mbUYE3VcvnyJweERbimIrvq//u21PMKLnP9+yfyNBWDmTePpmVmz3jSuqk5S1qSF7abxWHyMj7+IeQjX/Zb93Z+iXzf7KvZCePbffkxfbw8ABuNa/v4f/ktYxl1qtOXgQvbIBodHgEvztvPnsrdvdFHVLjo+BNO+QAkzYTZ0ugQ235jrfYzPkDvJ78EjaDpdAsZ1G5f9Y3yGh4Yo+k+fC3h+eGiI8fGxmHkCRlp6ulfI0tKXPocYCUISsrQ1KYxcHQtJkNLWRPmP+9qP+O6ZPXznhyJkC0VRFPTGbDL1a5f0wYqx+Bif2UQsFql48BvyYEUtW7eEx9WNBtqnajz0wtw5M2FudDod6RlZpGcszWpqLD7GJ95YLgLmYVkn++cix9zEeXO0rRAEIRws2+0XgiCsHETIBCEOCNeK5XJFhEwQhLhHhEwQhLhHhEwQhLhnxqqlZ7esIAhCvOAjZOnp6ezcuTNatgiCIATNe++95/1ZQktBEOIeETJBEOIeETJBEOIeETJBEOKemLrX8vyFy4yOjfkcS1q1ivXrjNF/SoYgCDFLTHlkH316ifbOj3xe733YScsfTmM/93FkJ7fXUqwoKEoxtfbIThUSTZUoioKiVNIUbVuEGTha6qg72kp/tA2Zk35aj9ZR1xL5mhNLRUx5ZLPhVFXet3XhdDr5q9zYeeSzsBgctNQ106l5yOK2e82UzHgcnKsdeysDnIu8fYubt5++2FawZUtcCJmHv3Sc4y8d5+Zss1afxV17FvGsqvwqTqlVi7RMCIb+1qM0tPaxbW8lZo1IOFqO0pp1EJNe2zqH3Dxobm1ld44Jvf9gESOUefWYDlZiipBlwuwsOLS8ePEiTz/9NP39s3/12Gw2nnnmGcb88l3CCsbRQv0ZMJXP9L5ySvxFzH18dyHGXgddS+zlRGteYfEs2CMbGRmhp6eH5557jkcffRS93vc/0GazUV9fT2pqKuPj46SkRD9J31SpUGYBMNOo1lEKgJ3a4gKqrYC5EfWxdooLqrFSRI3tFFX5TVQqZViAohobRzhEQbXVPaJ2HO8kKK5JXBTVYDtVhasY1/RY5sZGKCvD4p1nbtvttcW+8zbO+iaDmn/GezE3otaV+vUP4v25xzo13xsAoJ/W1g6MhRUBBcun3dF6zlBIxUETen0uOcYzOLr6Mc3o6Grb2ucKUVV1G3srS8gJx/lZ5nW01NHc77ZNY4n2+IBfG++5EmipP0OfO6RWt91Lpb+i97dyVNvGYPKZyzPW3hwHJ1r7ZpyfFUcLlhOd3l/VbSYKA7ULZn72UpHVSkNrn08b3N524Gs9c2yYLaWwOBYsZPn5+VRUVFBfXz9DzLQiFkjkokXpYzUUWaqxYuFYUx2lpYD9OA1WgCJqHisF2mftb60uoMDniIWy4u1eofAVG28nCorRiIm7Z1lZ0HZPC7Bm3gDdFzI/DYcosGraWsoobivCqj0WzPvDdV2UdrcQzkV/F45e0M+tYgHQYzLlcab5LA6T7wejv/UslFRi1oNHlJqPZnk/eKGdDzxvTm4eNDvo6jdNC3J/K60dkLfXNe5AgHeh9LVS32KiorLSJQr9rRytb6aOvdNi5mihrrmfwopKDmpsqj+Kj5gofa006++l0hykArhFTCsajpY6TvQp+KlxcPN3nqDFVI7ZrPeKU4Ol1SXM5hw8Ocbmllyf92Y50cm2vZUc9Jjd38rR+jqOFlZwcMH/FzNZ1KplQUEBFRUVjI6O8txzz9Hf3x+zIgZA/j7Ki1w/trW7liTtxxtw6Vg5++ZzKopqsKkqqqpiq3EPZG3guB2giafcH3Jzo6uNqtqoKQKs1Tzlv7ToHWseb8xey5NeB6nRd1wfFja/lXL3/I14nvRttUKNzdW30XuwnQ63HYe03pv/dbA8GeQqr5GseR/p78oxVWq9jJxc8uigy2+BTW8q0Xh3LuGhd8ArJKGeDzhvzm4Kjb04NDFnf5eDXvLInUNXVHUbe7XvSW+ipNAIHV24hnd5rHl7D/raVDIzxFXVbewN2o1x0NLcgcFU7uP55JRUYDJoy9YtYH6DiRJPI70JU56/Ta4cI/197pXbwDZ4rkHvmbOEY+100cl+j5jV19fz7LPPMjY2FpsiBkA++8qLqLZasTYcx15VRUe768NZVL6P+XTMfHjaq8mvOoy5ugwLVto7gI5jePTGUqZg8evb1m5HG6Npx5qTjnbcFro9Rtf7qDpsplrrpjUtbP7p91vKfjNYLPiIean34Fx2+F6HhuN2qoIKMReDO/ne5aAkx/cD7Gip40SntmjMtjCeDzSvntwcI2ccXfSbTOjpp8vRi7HQL4zyx5iFv4brDXo8q5w5uDzWvhMWOv37KqAfYNp7CjDWrLjFxDXXXO0WML/eMDOU9bMpK8uId//JHDb4XIMQJSOkVUutmMWuiLnI31dOUbUVq7WB4/bttFsAiiif1x3zw95OWyQMjGN2bJ/nGuoN6Jkt1zU/ObsLMda30ro7x+0xuMKXDvKmczGOFuqaPT1CPT/bvKDPzcF45gxnHSZKsrpw9BrJKQnP/3w4c0bxOH8ohLwhtqCggAcffDCmRQzQhJdWGg496fJczIfnTbYDWJ6sxRM9NT1V7fVQtucBedvxRHvTod30K7hkeAC847o8Hhd2ap+0zNIuzPMHsKNaE6faa93X0HMd5sTl3Sw6jNDnkqMN6RxddGCksGLaE+rXbuAK9fxs84I3nOrocrjCyjzTPAsY+IasXhM6wJhDrh6vlxPQhlCYddwBBnqDaRdJGzzH9MznMAZDWHb25+XlxbaIAZ7wEvAmts3750lSe7BWU6AoKIom+e4RwfwqDrvzSpYyxb3r3v0qnhbAhZs7ndezVhe4x3Svsvq0i9D8AcbHUuYde3rVM7gvg5ySCgqNHTTXHaXV53+6n9ajnmPuHeczdsa7QrpeR5f3uKL0MeBRh/5WWs70+vQI9fxs84I76d/RSoujl7y5kmPeuTpp1u6id7RwolMhz+TJm+Wwu9BIX2sDPpvt+1s5GtLue88XSIvPNXe0+G5Ijtz8c4ztaKGhtY+8vfOE5UESVxtiQ2U6rwNgJlgdK6pppLyhbFpEzL4rdaV1KrbtAVb2dmwPLh8W2FqqTtmguMBnXtv2J2fME5n5fcdX98/cfmFuVJlvwXIaVyI/t/UoDQ0WWt1HVdVAYUXgfWQ+vU0m8s40u0K6nBLKTf00uHM6qsFExd486j2hYajnZ53X0z+XPJrpoDCoUEw1mNib1YrFcsJ7zD+M05sOUs5Rr02efhUHQ/uY55RUspc6Tmiu+bZ7KzD113NG0y5S83vGNhtasGjHVg0UVpjn92aDRGlpaVF1Oh3Jycnccccd4Rl1kZw8/S49/YEWsINn0Tv7Z+C79yrkEE0IGc8+phn7r2J43tn2ngmh43lC7OTkZGx5ZDu35zF5fTKkMRJXJYbJGiHWCJR8X87zCsETU0KWmZ4abROEWEZv4mBlFO5kjNa8QtDElJCtLKZD1xn43F4kCLMx80kiHoK+fWmZEFM5MkEQhGDR5shi6sGKgiAIi2HZhJZ9N0ggJiwew8ex/FhgYT7EIxMEIe4RIRMEIe5ZNqGlFgkThGCQdMTyQTwyQRDiHhEyQRDinmUZWvojhX8FYXmzIoTso08vBbwZXWfr4qb8HPK33hAFq0LAXusulCI3tAsCrBAhm434LPzbRGVBNdTYUEXABAFY4ULmIaKFf8ONvZ22xTyiWxCWMTGT7JfCv0HiLQYiCIKHmBEybeHfQGLmKTc3NDTE+Ph4FCycjyYq53rMtL2WYsX3UdSVPqXa7NQWKyiVTdhrizXtKvE0a6pU3E9ptVJdoKAoxUGWYhOE5U3MCJmn8K+2VqaHmK6ZCa4q3EoZbTW26cIfR+B4k+Z8QTU7tMVBbDW0lSkU+yuRpYxDHHG3a8SMhTK34pXWqaiNZqDIXYdy/krlgrASiBkhgzgs/At4KxuZG31XD/OrqCoFaKKyzEJRjc33+fb5VRypKcJa/RQ+jllRDUe845TyWE0RWI7hX+dXEIRpYkrIwFfMnn322RgXMcB+nAbrHBWZ3HUwA9V+zN++A2ijXeuUhalgiCCsJGJOyGBazGK7erkgCLFCzG6/8BT+NRqNsS1i+dvZAbS126E0gC81x3l7exuwg/kKdQuCMDcx6ZF5iI/Cv648lrW6wHcVsqnS/fvs5wuqrZgb6wi6NKQgCAGJWY8snsivOoW6vRKlTJkuJmJuRK2b47x75VFWHQUhdJZN8RHts6X8n0cWW4V/hVhhrv8ZIfaJ2QK9kUIK/wrC8mZFCJkU/hWE5U1MJ/sFQRCCQYRMEIS4R4RMEIS4R4RMEIS4R4RMEIS4R4RMEIS4R4RMEIS4R4RMEIS4Z9WePXvQ6XR0dnZG25Zlx+WePtavNXDy9LsBz+/cniebdQUhDKyInf3R4IPOc/T0DbJ+rWHW+zxDvW1KEAQXElpGgA86z9He+VG0zVg4mgIpxbV2V7ET/yIqcUS82y8EjwhZmIlbEdMW/lVVTlVBe1u0bRKE4JDQMozEr4gRoPBvPlWnVKqiapQgBIcIWZhwOp2sM2SxzpDlPRZXj/5xF/4tj7YdgrAIJLQME2PXJujuG/B5XbjSzQed50IcOXqFfwPmmJoqfeYqrm3yjh/Q+lnyVL7H3TYGsM3b1t9+d9/Z3pOwshAhCxNj4+O0d34U8LVoYqzwr722GKXMglkz3+H2Mqqts7+F0v1msDZw3FcNOWYB8+Eq8gF77VNwxDOmjZoiC2X+4qe131ZDkbWaAkWhoP1wwPckrCxEyGKWWCv828RT1dYZ85XW2agpmqNb6WPUFFlp0CpZ0zEsmPGUAs2vqtMIZz5Vh81gbadjNvvzqzhsBjDT6DWmlP1moK1dVilXIJIjCxNr9Vncv/fu8A3oKfx7OLTCv94KdKEW/p1jvrnJZ195EdUNx7FXVZHvFuiiGptP9aimSoUyi7af2XeYQPYXbSdP82ve9iKQldYViQhZiDjbbKgDw2EZK+EuU1jGiTXy95VTVN3AcXsVVRynwVpE+RGPLDVRqZRhwUyj6i6N11SJUhZFg4W4Q4QsRN47+zajV7r567ztAEw5nZx47yzpa1KZmLzG39y8y9v2rc4PmZpyUlTwWY6f/RNFBTdhTEsPPHCsFf6ddb4O2q3Ajrn67qO8qJqG43b20YC1qJxpHTuGhSJqbNP1PT32C0KwSI4sRDYY1/KLP7xO15VLAPyu7Sytjg56hwept57kRNvbALRf+JjnXm/mj/YPAHj57Fv0jgzNMXKsFf515aCs1YfQriM0VZbhExF6Vll9jHLlvawNT/FUg9Wb5J/GSrsnIWav5dBcqweCEAARshBZl5nFlwvv4Ke//x0f93bzyjtneORzJegUhTVJq3np9ClaHXaefe23pCSuXtDY+VWnUBvNWMo0WxOO7fcm2wOeL2ujxqb6LgCEidI6lUazZ4uG63Vsv3+yP4/tgZL/pfsxWy1YrNNJfveg2GqKpt/DITjSaA4wgCDMjjI0NKR6nn6xc+fOaNuzaKJVbHXqZCvOnj5+cPyXfNLTwxd23sa+3X/N8bN/wn7xU3LXb+SVd85QsHEzues30nX5IlVfPMA//vu/UrXvAAUbNnvHWnX/F5bM7vBhp7a4gOodjahzqmew7ZYOKdAb32gL9IpHFgYUFMp27eHa9Unu21Xoc+7LhXdwzy27MH+hjATdMrzcntXV/fOIk92V5K95LDZETFheSLI/TKxa5bqUq3QJPscVFMrvuCtgnz/aPsB24RMAbv1MLjmRNTFk7LXFHOKIZl+b60Zza1ENR+bRp6anqrGaGzkVzgUIQXAjQhYmUhKTKNg4HSYa0zIYM074tNEeK9i4md7hIXqHXQn/3OwNS2fsIsmvOsXhSgVF0Rw0zx0q2muLKai2QlENtlPijQmRQXJkITJ1shW1pz8sY8Vnjix+kRxZfKPNkYlHFiLLdROrIMQTyzD7LAjCSkOETBCEuEeETBCEuEeETBCEuGdZJvu1q1GCICx/xCMTBCHuESETBCHuicnQ8uLFi4yMjJCfH3yIuNANjZ7SbWv1Wdy151Z+1fxGwHZ37bmVtfqsgOeWN7F3k7cgzEbMeWSqqvLSSy/x4osvYrPZIjJHXNefFARhBjEnZIqi8MADD5Camkp9fX3YxUxETBCWHzEZWur1eh599FGee+456uvrqaiooKCgIORx476IriAIAYk5j8yDR8zC6ZlFroguwReunbegbqChQyhQG+x8fvYrlccXfy0EYYmJWSGDaTFLSUmhvr6ejo6O+TvNgbaI7qk/nea1k3/wvi5e+MT76uu5sqBxgy5cu5CCuv4spkBtsPM1Vc6wv5HqOQvvCkIsEdNCBtDd3c3Y2BipqakYjcawjfvWyTd45T8aAr7eOhl4BTMwwRauXWBBXX8WXKA22PkCt5u38K4gxBAxmSPzYLPZqK+vJzU1lUcffRS9Xh+2se+7vzw8AwVbuHahBXX9WWiB2mDnY7GFdwUhdohZIYukiAG89eYb9HUHDiEN67K5/c4wVg0XBCGixGRoGWkRAzCsXcf6LTcEfBnWrgt+IG3hWh/chWvnbbcEBXXnmi9Y+wUhhok5IVNVlZMnT0ZUxAAMa9eyYfMWn9ctO2/jtj13kLf9pgWMFGzh2mAL6gYqcLsYgp0vWPsFIXaJudBSURQefvhhrl27RlZW5G4NeuvkG1z89BOfY/cdKGfjpi0LHqu0TqURhbIChWr3MXOjjZq2Au/v4C6ou70SpUzRiEQRNTYVb2Gi2QrcLoLg5gvefkGIVZZN8ZFg6Okf4OTpdxfUZ/H3Wsq9ioIQSaRA71IQbOFaQRBCRoQsDNhri/02tE4XrpXC2oIQeWIuRxZJElclLjhMDOZezMUUrhUEIXysqByZIAjLh2VXoFee0R8/SEVvIRJIjkwQhLhHhEwQhLhnWYSWWiR0iT0k9BcijXhkgiDEPSJkgiDEPcsutFwI5wau0XZljO7RSQCyUxO5JTuFrVmro2yZIAgLYcUJ2dVJJzqg4YM+/nxlzOecrXecN88Pc3N2CuWfNeAE1iSK0yoIsc6KErKB8Sl+cOoiqYkJDFy7Pmu7P18Z49PBy4xOTvE/ijeSlZywhFZO01SpUNZWg+1U1cynwwqC4GVFCZlOAQUYuHadGzKTuDc3k+7RSX5jGyAxQWHPplQATl8YZeDadZJ0Cjpl7jEjh532tvlbCYKwwpL9GasT+OpNBpJ0Ov6xcD2nX/klyidtPLzDSPlNBtb1tTN0+mXKbzIA8NWbDGSsjo43BvlUnVJRxRsThHlZUUIGkJqkIzttFToFDh8+zNNPP83m9CS2ZCRRV1fH448/zpaMJEDyY4IQL6y4T2pqYgKfDE0wfG2KkydP8uMf/5hf/fHP/Pqtdv71Rz/i5JtvYv14BIC0pOC8scUX0LW7ivjOcr6pcnocb1v/eQIV5Z1pYMSKBwtCLLDihGz1KlfS659PXuD3fcnUne3F9ovv8+HPvk/d2V5+/lECJ88PAwv0yBZRQNde+xQc8RTFtVFTZKHMK1xBzBOoKK8fS1I8WBCizIoSMtXpZMjxFxScOIF3L1+le0LHff/tf/OF//pdeiZ09I25VjMVnAw4/ozqdAY3+IIL6EJ+VZ3m2fn5VB02g7WdOeupa5rfYNYAAAISSURBVOdxFxjBcmwWr2yJigcLQpRZUUI2NjzAh68dI3ly1Od48yUdJy75XorkyVHaXz3G2PBAcIMHW0DXj6ZKTShXFkTdokDzzEaYiwcLQqyyooRsTaaBwkceYywxfd62Y4npmL7xGGsyDRGyxlX2rcxiptETyjWaIzSXICxvVpSQAVxbwNa58Uhus2s6hoUiamye+pKewrlhJFaLBwtCmFlxQjY8EWTOCxiZmIqgJQBW2j0JMXsth2Zk4BeKf3HfcBcPFoTYZMUJ2ZRTDbrtApounNI6bDVFWMrc+bFDcCTk0HJmcd/SOpVGs5Xqgulc3LH9/sl+dzHfRvO0PYqCUtZGjU1FaqgIsc6yKD6ifXDffA9WHJmY4v+cvDCvSOkU+F93bQp6L1l8sbTFgxfy9xGEYFnRBXrTkhL4/NaMedt9fmvGMhUxpHiwsOxYcUIGkPLH5ylZc5lVAe4IX6VTKFlzmZQ/Ph8Fy8KPFA8WVgIr6ukXHnJ334lhy1aKV2fQ3jtG/5grqa9PSWC7MQXdtTT69Mvj0kjxYGElsDw+rQtk82d3eX82bUyd2SApy6dNvFNap6LWRdsKQYgcKzK0FARhebHsPDIpPSYIKw/xyARBiHtEyARBiHuWRWgpmywFYWUjHpkgCHFP3Hhkg8OjvOe+w3rn9jwy0wNsmxAEYUUSN0I2eX2Snv4B78+CIAge/j8UQ8AdT/eHsAAAAABJRU5ErkJggg==" srcset="/img/loading.gif" lazyload alt="img"></p><h3 id="4-1-x2F-conf-x2F-config-yaml"><a href="#4-1-x2F-conf-x2F-config-yaml" class="headerlink" title="4.1 .&#x2F;conf&#x2F;config.yaml"></a>4.1 .&#x2F;conf&#x2F;config.yaml</h3><figure><div class="code-wrapper"><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8123</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"v1.2.3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure><h3 id="4-2-gin中使用viper案例"><a href="#4-2-gin中使用viper案例" class="headerlink" title="4.2 gin中使用viper案例"></a>4.2 gin中使用viper案例</h3><ul><li>这里用一个demo演示如何在gin框架搭建的web项目中使用<code>viper</code>，使用viper加载配置文件中的信息</li><li>并在代码中直接使用<code>viper.GetXXX()</code>方法获取对应的配置值。</li></ul><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/fsnotify/fsnotify"</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"github.com/spf13/viper"</span>
	<span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 第一：viper配置</span>
	viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>       <span class="token comment">// 还可以在工作目录中查找配置</span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigName</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span>  <span class="token comment">// 配置文件名称(无扩展名)</span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span>    <span class="token comment">// 如果配置文件的名称中没有扩展名，则需要配置此项</span>
	viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"./conf/"</span><span class="token punctuation">)</span> <span class="token comment">// 指定查找配置文件的路径</span>

	err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 读取配置信息</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>             <span class="token comment">// 读取配置信息失败</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// 第二：实时监控配置文件的变化</span>
	viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	viper<span class="token punctuation">.</span><span class="token function">OnConfigChange</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>e fsnotify<span class="token punctuation">.</span>Event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// 配置文件发生变更之后会调用的回调函数</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Config file changed:"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

	<span class="token comment">// 第三：读取配置</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/version"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure><h3 id="4-3-结构体变量保存配置"><a href="#4-3-结构体变量保存配置" class="headerlink" title="4.3 结构体变量保存配置"></a>4.3 结构体变量保存配置</h3><figure><div class="code-wrapper"><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/spf13/viper"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Port    <span class="token builtin">int</span>    <span class="token string">`mapstructure:"port"`</span>
	Version <span class="token builtin">string</span> <span class="token string">`mapstructure:"version"`</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> Conf <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Config<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 第一：viper配置</span>
	viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>       <span class="token comment">// 还可以在工作目录中查找配置</span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigName</span><span class="token punctuation">(</span><span class="token string">"config"</span><span class="token punctuation">)</span>  <span class="token comment">// 配置文件名称(无扩展名)</span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span>    <span class="token comment">// 如果配置文件的名称中没有扩展名，则需要配置此项</span>
	viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">"./conf/"</span><span class="token punctuation">)</span> <span class="token comment">// 指定查找配置文件的路径</span>

	err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 读取配置信息</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>             <span class="token comment">// 读取配置信息失败</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fatal error config file: %s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// 第二：将读取的配置信息保存至全局变量Conf</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>Conf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"unmarshal conf failed, err:%s \n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Conf:%#v\n"</span><span class="token punctuation">,</span> Conf<span class="token punctuation">)</span> <span class="token comment">// 打印</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
Conf:&amp;main.Config&#123;Port:8123, Version:"v1.2.3"&#125;
 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Go%E5%B8%B8%E7%94%A8%E5%BA%93/" class="category-chain-item">Go常用库</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Go%E5%B8%B8%E7%94%A8%E5%BA%93/">#Go常用库</a></div></div><div class="license-box my-3"><div class="license-title"><div>viper配置管理</div><div>http://example.com/2022/06/09/Go常用库介绍 - viper/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Evan Deng</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年6月9日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/06/11/Go%E5%B8%B8%E7%94%A8%E5%BA%93%E4%BB%8B%E7%BB%8D%20-%20gRPC/" title="gRPC"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">gRPC</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/06/07/Go%E5%B8%B8%E7%94%A8%E5%BA%93%E4%BB%8B%E7%BB%8D%20-%20zap/" title="zap"><span class="hidden-mobile">zap</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>